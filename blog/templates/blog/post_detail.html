{% extends 'blog/base.html' %}

{% load image_utils %}
{% load static %}
{% load i18n %}

{% block title %}
  <title>{{ post.title }}</title>
{% endblock title %}

{% block meta_tags %}
  <meta name="description" content="{{ post.description }}">
  <meta name="keywords" content="{{ meta_keywords }}">
  <link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url }}">
  <meta property="og:title" content="{{ post.title }}">
  <meta property="og:description" content="{{ post.description }}">
  <meta property="og:type" content="article">
  <meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url }}">
  <meta property="og:image" content="{{ post.cover.url }}">
  <meta property="og:image:width" content="1280"/>
  <meta property="og:image:height" content="720"/>
  <meta property="og:site_name" content="lulzcasz">
  <meta property="article:published_time" content="{{ post.published_at|date:'c' }}" />
  <meta property="article:modified_time" content="{{ post.updated_at|date:'c' }}" />
  <meta property="article:section" content="{{ post.verbose_name|title }}" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ post.title }}" />
  <meta name="twitter:description" content="{{ post.description }}" />
  <meta name="twitter:image" content="{{ post.cover.url }}" />
  {% for tag in post.tags.all %}
    <meta property="article:tag" content="{{ tag.name }}" />
  {% endfor %}
  {% language 'pt-br' %}
    <link rel="alternate" hreflang="pt-br" href="{{ request.scheme }}://{{ request.get_host }}{% url 'post-detail' post.slug_pt_br %}" />
  {% endlanguage %}
  {% language 'en-us' %}
    <link rel="alternate" hreflang="en-us" href="{{ request.scheme }}://{{ request.get_host }}{% url 'post-detail' post.slug_en_us %}" />
  {% endlanguage %}
{% endblock meta_tags %}

{% block main %}
  <main class="container flex-fill">
    <div class="row">
      <div class="col-xl-9">
        <h1 class="pb-2 pt-2">{{ post.title }}</h1>
        <p>{{ post.description }}</p>
        <p class="pb-2">{{ post.created_at | date }}</p>
        <div class="pb-3">
          <img
            class="img-fluid"
            style="aspect-ratio: 191/100; object-fit: cover;"
            src="{{ post.cover|variant:'large' }}"
            alt="{{ post.title }}"
          >
        </div>
        <div class="pt-3">
          {{ post.content | safe }}
        </div>
      </div>
      <div class="col-xl-3 mt-3" style="position: sticky; top: 1rem; height: fit-content;">
        {% if post.source_code %}
          <div class="pb-2">
            <a target="_blank" href="{{ post.source_code }}" 
              class="btn btn-lg w-100 d-flex justify-content-center align-items-center gap-1 text-decoration-none" 
              style="background-color: #151516; color: #E7E7E7; border: none;">
              <i class="fs-3 fa-brands fa-github-alt"></i>
              {% trans 'CÃ³digo Fonte' %}
            </a>
          </div>
          <hr class="pb-2">
        {% endif %}
        <div>
          {% if post.get_related_posts %}
            {% for related_post in post.get_related_posts %}
            <div class="pb-3">
              <a href="{% url 'post-detail' post_slug=related_post.slug %}" class="text-decoration-none text-reset">
                <div class="card border-0 rounded-4">
                  <div style="position: relative;"> 
                    <img 
                      src="{{ related_post.cover|variant:'small' }}" 
                      class="card-img-top rounded-top-4" 
                      alt="{{ related_post.title }}"
                      style="aspect-ratio: 191/100; object-fit: cover;"
                    >
                    <span class="badge rounded-3" style="
                      position: absolute; 
                      top: 10px; 
                      left: 10px; 
                      font-size: 0.75em;
                      z-index: 10;
                    ">
                      {{ related_post.verbose_name|title }} 
                    </span>
                  </div>
                  <div class="card-body bg-body-tertiary rounded-bottom-4" style="background-color: #1E1E1E !important;">
                    <h5 class="card-title">{{ related_post.title }}</h5>
                  </div>
                </div>
              </a>
            </div>
            {% endfor %}
          {% endif %}
        </div>
        <div class="pb-3">
          <hr class="pb-2">
          <div class="d-flex justify-content-center flex-wrap gap-2">
            {% if "tutorial" in post.verbose_name|lower %}
                {% url 'tutorials' as type_url %}
            {% else %}
                {% url 'articles' as type_url %}
            {% endif %}
            <a href="{{ type_url }}" class="btn btn-sm btn-dark rounded-pill px-3">
                {{ post.verbose_name|title }}
            </a>
            {% for tag in post.tags.all %}
              <a href="{% url 'posts-by-tag' tag_slug=tag.slug %}" class="btn btn-sm btn-dark rounded-pill px-3">
                {{ tag.name }}
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </main>
{% endblock main %}
